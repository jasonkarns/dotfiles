#!/usr/bin/env bash

set -euo pipefail
cd ~

clone_repos() { while read -r repo; do git clone "https://github.com/$repo.git"; done; }

export HOMEBREW_BUNDLE_FILE=~/.config/Brewfile
brew bundle check || {
  echo "==> Installing Homebrew dependencies…"
  brew bundle
}

if [ -d /opt/rbenv/plugins ]; then uprbenv
else echo "==> Setting up rbenv…"
  sudo install -m 0755 -o "$USER" -d /opt/rbenv/plugins
  ( cd /opt/rbenv/plugins; clone_repos <<PLUGINS
  tpope/rbenv-aliases
  ianheggie/rbenv-binstubs
  aripollak/rbenv-bundler-ruby-version
  tpope/rbenv-ctags
  sstephenson/rbenv-default-gems
  chriseppstein/rbenv-each
  ianheggie/rbenv-env
  mlafeldt/rbenv-man
  rkh/rbenv-update
  jasonkarns/ruby-build-update-defs
PLUGINS
  )
fi

if [ -d /opt/nodenv/plugins ]; then upnodenv
else echo "==> Setting up nodenv…"
  sudo install -m 0755 -o "$USER" -d /opt/nodenv/plugins
  ( cd /opt/nodenv/plugins; clone_repos <<PLUGINS
  nodenv/node-build-update-defs
  nodenv/nodenv-aliases
  nodenv/nodenv-default-packages
  nodenv/nodenv-each
  nodenv/nodenv-man
  nodenv/nodenv-package-json-engine
  nodenv/nodenv-package-rehash
  nodenv/nodenv-update
PLUGINS
  )
fi

open .config/Solarized-JK.terminal
defaults write com.apple.Terminal "Default Window Settings" -string "Solarized-JK"
defaults write com.apple.Terminal "Startup Window Settings" -string "Solarized-JK"
